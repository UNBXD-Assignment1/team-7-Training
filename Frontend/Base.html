<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="categoryPage.css">
    
</head>
<body>
    <iframe src="Header.html" title="header" style="width:100%" frameBorder="0"></iframe>
    
    
    <div class="products_container" id="product_list">
    </div>

    <div class="unique_product_container" id = "unique_product_container" style="display: none;">
    </div>

</body>
    <script type="text/javascript">
        // window.onload=function(){
        //     var img_url=["https://images.unsplash.com/photo-1515372039744-b8f02a3ae446?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8OXx8ZHJlc3N8ZW58MHx8MHx8&w=1000&q=80", "https://images.unsplash.com/photo-1595777457583-95e059d581b8?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8Mnx8ZHJlc3N8ZW58MHx8MHx8&w=1000&q=80", "https://images.unsplash.com/photo-1626818590159-04cb9274a5e0?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8MTd8fGRyZXNzZXN8ZW58MHx8MHx8&w=1000&q=80","https://images.unsplash.com/photo-1623609163859-ca93c959b98a?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8MTJ8fGRyZXNzfGVufDB8fDB8fA%3D%3D&w=1000&q=80"]
        //     var product_block=document.getElementById("product_list")
        //     console.log("hi")
        //     for(var i=0; i<10; i++){
        //         product_block.innerHTML+=`
        //         <div class="card">
        //             <img id="product_image" src=`+ img_url[i%img_url.length]+`/><br/>
        //             <p id="price" >$120</p>
        //             <p id="desc">Desc of this prod</p>
        //         </div> `
        //     }
        // }
        window.onload=function(){
            
            //var img_url=["https://images.unsplash.com/photo-1515372039744-b8f02a3ae446?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8OXx8ZHJlc3N8ZW58MHx8MHx8&w=1000&q=80", "https://images.unsplash.com/photo-1595777457583-95e059d581b8?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8Mnx8ZHJlc3N8ZW58MHx8MHx8&w=1000&q=80", "https://images.unsplash.com/photo-1626818590159-04cb9274a5e0?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8MTd8fGRyZXNzZXN8ZW58MHx8MHx8&w=1000&q=80","https://images.unsplash.com/photo-1568251188392-ae32f898cb3b?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8Mnx8ZWxlZ2FudCUyMGRyZXNzfGVufDB8fDB8fA%3D%3D&w=1000&q=80"]
            const queryString = window.location.search;
            const urlParams = new URLSearchParams(queryString);
            const cat1_value = urlParams.get('cat1');
            const cat2_value =urlParams.get('cat2');
            const prod_query =urlParams.get('q');

            if (cat1_value!=null){
                var product_block=document.getElementById("product_list");
                fetch(`https://33bd8667-5c26-4e78-9318-11e0e0eb3a22.mock.pstmn.io/get-products?cat1=${cat1_value}&cat2=${cat2_value}`, {
                    method: 'GET',
                    mode : 'cors',
                            headers: {
                        'Access-Control-Allow-Origin':'*',
                                'Accept': 'application/json',
                                'Content-Type': 'application/json'
                            }
                }).then(response => response.json()).then((data)=>{
                    for (const prod of data){
                        var tempid=String(prod.uniqueId);
                        product_block.innerHTML+=`
                        <div class="card" onclick="window.open('Product.html?uid=${tempid}','_blank');">
                            <img id="product_image" src=`+ prod.productImage+`/><br/>
                            <p id="price" >₹ ${prod.price}</p>
                            <p id="desc">${prod.title}</p>
                        </div> `
                    
                    }
                })
            }
            else if(prod_query!=null){
                
		
                var product_block=document.getElementById("product_list");
                fetch(`https://6d5a1111-cebb-459b-a072-32d9009ccafd.mock.pstmn.io/search-products?q=${prod_query}`, {
			    method: 'POST',
                mode : 'cors',
			    headers: {
                'Access-Control-Allow-Origin':'*',
				'Accept': 'application/json',
				'Content-Type': 'application/json'
			    },
			    body: JSON.stringify({ "q" : prod_query})
            }).then(response => response.json()).then((data)=>{
                    for (const prod of data){
                        var tempid=String(prod.uniqueId);
                        product_block.innerHTML+=`
                        <div class="card" onclick="window.open('Product.html?uid=${tempid}','_blank');">
                            <img id="product_image" src=`+ prod.productImage+`/><br/>
                            <p id="price" >₹ ${prod.price}</p>
                            <p id="desc">${prod.title}</p>
                        </div> `
                    
                    }
                })
            }
            else{
                var product_block=document.getElementById("product_list");
                fetch('https://33bd8667-5c26-4e78-9318-11e0e0eb3a22.mock.pstmn.io/get-products', {
                    method: 'GET',
                    mode : 'cors',
                            headers: {
                        'Access-Control-Allow-Origin':'*',
                                'Accept': 'application/json',
                                'Content-Type': 'application/json'
                            }
                }).then(response => response.json()).then((data)=>{
                    for (const prod of data){
                        var tempid=String(prod.uniqueId);
                        product_block.innerHTML+=`
                        <div class="card" onclick="window.open('Product.html?uid=${tempid}','_blank');">
                            <img id="product_image" src=`+ prod.productImage+`/><br/>
                            <p id="price" >₹ ${prod.price}</p>
                            <p id="desc">${prod.title}</p>
                        </div> `
                    
                    }
                })
            }
            
            
        }

        function productClickHandler(id, prod_img, price, title, desc){
            window.open('https://www.3schools.in','_self');
            document.getElementById("product_list").style.display="none";
            var prod_div = document.getElementById("unique_product_container");
            prod_div.style.display="block";
            // prod_div.appendChild(document.createTextNode("Hi prod page : "+id));
            prod_div.innerHTML+=`
                <div class="unique_product_card">
                    <img class="unique_product_image" src="${prod_img}" />
                    <h1 class="unique_product_title"> ${title}</h1><h2 class="unique_product_price"><strong>₹ ${price}</strong></h2><br/>
                    <h3 class="unique_product_description">${desc}</h3>
                    
                </div>
            `;

        }
        
        
    </script>
</html>